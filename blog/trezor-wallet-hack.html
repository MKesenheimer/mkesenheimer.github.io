<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/mkesenheimer.github.io/" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#002241" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#002241" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" media="all" href="/Resources/Static/Packages/matthias.kesenheimer/Styles/prism.css" />
    <link rel="stylesheet" media="all" href="/Resources/Static/Packages/matthias.kesenheimer/Styles/Main.min.css" />

    <script src="/Resources/Static/Packages/matthias.kesenheimer/JavaScript/jQuery.js"></script>
    <script src="/Resources/Static/Packages/matthias.kesenheimer/JavaScript/Plugins/anime.min.js" defer></script>
    <script src="/Resources/Static/Packages/matthias.kesenheimer/JavaScript/Plugins/prism.js" defer></script>
    <script src="/Resources/Static/Packages/matthias.kesenheimer/JavaScript/Plugins/chart.js" defer></script>
    <script src="/Resources/Static/Packages/matthias.kesenheimer/JavaScript/Main.js" defer></script>
    <title>Physik, Elektronik und mehr... | Blog</title>
    <meta name="robots" content="index,follow" />
</head>

<body class>
    <div id="wrapper">
        <div id="header">
            <div class="menu">
                <nav class="paddingTop30 paddingBottom15 kesenheimer-menu">
                    <menu-ul>
                        <li class=""><a href="/about-me.html">Ãœber mich</a></li>
                        <li class="current"><a href="/">Blog</a></li>
                        <li class=""><a href="/blog/pico-glitcher-v2.html">Pico Glitcher</a></li>
                        <li class=""><a href="/contact.html">Kontakt</a></li>
                    </menu-ul>
                </nav>
            </div>
        </div>

        <section id="content">
            <div class="neos-contentcollection">
                <div class="paddingTop0 paddingBottom30 kesenheimer-container">
                    <div class="inner container-fluid">
                        <div class="neos-contentcollection">
                            <div class="paddingTop0 paddingBottom0 kesenheimer-headline">
                                <div>
                                    <h1 style="text-align: center">Attacking the Trezor One Crypto Wallet</h1>
                                </div>
                            </div>
                            <div class="paddingTop0 paddingBottom0 kesenheimer-text">
                                <div>
                                    <p style="text-align:center">Successfully glitching firmware versions v1.6.1 and later</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Block -->
                <div class="color-white paddingTop0 paddingBottom0 kesenheimer-container">
                    <div class="inner container-fluid">
                        <div class="neos-contentcollection">
                            <!-- Text -->
                            <div class="neos-nodetypes-html">
                                <div class="paddingTop30 paddingBottom15 kesenheimer-text">
                                    <div>
                                        <div class="paddingTop0 paddingBottom15 kesenheimer-warning">
                                            <div>
                                                <p>I am selling the PicoGlitcher on <a href="https://www.tindie.com/stores/faulty-hardware/">tindie.com</a>.</p>
                                                
                                                <p>More links:</p>
                                                <ul>
                                                    <li>The Pico Glitcher and findus (the software to control the Pico Glitcher) is open source: <a href="https://github.com/MKesenheimer/fault-injection-library">fault-injection-library</a></li>
                                                    <li>Documentation of the Pico Glitcher and findus: <a href="https://fault-injection-library.readthedocs.io/en/latest/">fault-injection-library.readthedocs.io</a></li>
                                                    <li>hackaday.io project page: <a href="https://hackaday.io/project/196357-picoglitcher">hackaday.io/project/196357-picoglitcher</a></li>
                                                    <li>The Pico Glitcher was featured on Hackaday: <a href="https://hackaday.com/2024/10/30/use-picoglitcher-for-voltage-glitching-attacks/">hackaday.com/2024/10/30/use-picoglitcher-for-voltage-glitching-attacks/</a></li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div class="paddingTop15 paddingBottom15 kesenheimer-headline">
                                            <div>
                                                <h2>Glitching firmware versions pior to v1.6.0</h2>
                                            </div>
                                        </div>

                                        <p>The Trezor One is one of the earliest and most popular hardware wallets for securely storing cryptocurrencies. It isolates private keys from internet-connected devices, providing strong protection against malware and remote attacks.</p>

                                        <p>Voltage glitching, which involves briefly tampering with the device's power supply to induce faults, can be necessary if the owner of the device has forgotten their PIN for unlocking the crypto wallet. By precisely timing these glitches, we can bypass security checks and extract sensitive data, such as the wallets passphrase.</p>

                                        <p>This article will explain how to attack the Trezor One with firmware versions prior to v1.6.1 and how to get from read-out protection level 2 (RDP2) to RDP1. With RDP1 enabled, other attacks can be performed, for example reading out the chips SRAM to extact the passphrase. This attack has been shown previously by <a href="https://blog.kraken.com/product/security/kraken-identifies-critical-flaw-in-trezor-hardware-wallets">Kraken</a>, <a href="https://chip.fail">chip.fail</a> and <a href="https://wallet.fail">wallet.fail</a>. However, as the issue of extracting the wallet's passphrase with SRAM access has been resolved in later firmware versions, this attack will not work on versions v1.6.1 and above. A later section will cover a new attack that works on all recent Trezor wallets.</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/01-original-target.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <div class="paddingTop15 paddingBottom15 kesenheimer-headline">
                                            <div>
                                                <h2>Preparations</h2>
                                            </div>
                                        </div>

                                        <p>We start by covering delicate components with a metal foil and desolder the marked capacitors:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/02-covering-delicate-components.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/03-desoldered-capacitors.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>Then, a breakout pinheader is soldered to the Trezor One to get SWD access:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/04-soldered-breakout-pinheader.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>An SMA connector is glued to the backside of the device and connected the positive lead (middle pin) to the 'V_CAP' line and the negative lead to 'GND':</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/05-backside.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/06-sma-connector-on-vcap.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>The two tactile switches are bridged. If the two buttons are pressed simultaneously, the Trezor One enters the bootloader mode for software updates. In this state, the recovery key is present in SRAM.</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/06b-bridged-tactile-switches.jpeg" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>An ST-Link debug adapter is connected to the SWD lines, and the reset line to 'RESET', as well as the power lines to the Pico Glitcher. Then, the input 'EXT1' is connected to the crowbar glitch output 'GLITCH'. This is necessary to trigger on the rising-edge of the voltage on the 'V_CAP' line (green dupont cable in the following figure).</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/07-glitching-setup.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/08-trezor-connections.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>Channel 1 of an oscilloscope is connected to the 'VCAP' line via the SMA connector, channel 2 to the 'VTARGET' output and the external trigger input of the oscilloscope to the 'EXT1' hook.</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/09-pico-glitcher-setup.JPG" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>It is important not to connect the Trezor One to a computer via USB during glitching.</p>

                                        <div class="paddingTop15 paddingBottom15 kesenheimer-headline">
                                            <div>
                                                <h2>Voltage Traces</h2>
                                            </div>
                                        </div>

                                        <p>The startup sequence of the STM32F205 can now be verified by measuring the voltage traces during startup:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/10-startup.bmp" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>The level of the voltage supply should slowly rise in comparison to the voltage on the 'V_CAP' line. Furthermore, the voltage output on the 'VCAP' line is delayed approximately 150ms after the device is powered on. Powering the device and measuring the voltage traces can be done with the command:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">power-on --rpico /dev/<tty-device></code>
                                            </pre>
                                        </div>

                                        <div class="paddingTop15 paddingBottom15 kesenheimer-headline">
                                            <div>
                                                <h2>Glitching</h2>
                                            </div>
                                        </div>

                                        <p>Now everything is set up, we can start glitching our device. For this, the script 'stm32f2-boot-debugger.py' has been prepared. This script powers up the device, waits for the trigger signal on input 'EXT1', waits a given delay and emits a glitch of a certain length. Afterwards, it is tested if memory can be read from RAM.</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/11-vcap-power-trace.bmp" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>Successful glitches should be found about 176us after the 'VCAP' line comes up. Start by searching a wider parameter space and reduce the parameter space when the first positive events are observed. The glitch length is not critical, but in general shorter glitches are preferable.</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">python stm32f2-boot-debugger.py --rpico /dev/<tty-device> --length 100 500 --delay 175_600 176_700 --halt [--resume]</code>
                                            </pre>
                                        </div>

                                        <p>We can use the 'analyzer' from 'findus' to analyze the glitch parameters:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">analyzer --directory databases --auto-update 60</code>
                                            </pre>
                                        </div>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-image">
                                            <figure>
                                                <img title="" alt="" src="/Resources/Persistent/2025/10/images/12-parameterspace.png" width="3264" height="2448" />
                                            </figure>
                                        </div>

                                        <p>When the script is stopped (when a successful glitch is detected), further instructions are printed to the terminal:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">
[+] Experiment 158	12914	(3)	176526	126	R	b'success: read zero'
[+] Now connect the Trezor One via USB with your computer and go to the Trezor Suite app.
    Wait for the Trezor One to connect. Do not abort this script!
    If the pin input on the Trezor comes up, execute the following command to dump the memory:
    $ openocd -f interface/stlink.cfg -c "transport select hla_swd" -f target/stm32f4x.cfg -c "init; reset run"
    Connect to openocd via gdb or telnet:
    $ telnet localhost 4444
    $ arm-none-eabi-gdb
    (gdb) target remote :3333
    (gdb) monitor reset halt
    (gdb) continue
    Or dump the RAM as is with the following command:
    $ openocd -f interface/stlink.cfg -c "transport select hla_swd" -f target/stm32f4x.cfg -c "init; dump_image ram.bin 0x20000000 0x1fffffff; exit"
                                                </code>
                                            </pre>
                                        </div>

                                        <p>In this state, we can either try to dump the RAM contents:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">openocd -f interface/stlink.cfg -c "transport select hla_swd" -f target/stm32f4x.cfg -c "init; dump_image ram.bin 0x20000000 0x1fffffff; exit"</code>
                                            </pre>
                                        </div>

                                        <p>Or we can connect to the device via telnet or gdb. First, a debug connection with openocd is initialized:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">openocd -f interface/stlink.cfg -c "transport select hla_swd" -f target/stm32f4x.cfg -c "init; reset run"</code>
                                            </pre>
                                        </div>

                                        <p>Then we connect to the device via telnet:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">telnet localhost 4444</code>
                                            </pre>
                                        </div>

                                        <p>Or GDB:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">
arm-none-eabi-gdb
(gdb) target remote :3333
(gdb) monitor reset halt
(gdb) continue
                                                </code>
                                            </pre>
                                        </div>

                                        <p>By dumping the RAM in this state, the recovery key should be visible in the dump. Observe the RAM dump with the 'strings' command:</p>

                                        <div class="paddingTop0 paddingBottom30 kesenheimer-code">
                                            <pre class="line-numbers-rows">
                                                <code class="language-php">strings ram.bin</code>
                                            </pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row paddingTop0 paddingBottom30 neos-nodetypes-twocolumn">
                                <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12 is-page neos-contentcollection"></div>
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 is-page neos-contentcollection"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Block -->
                <div class="color-white paddingTop30 paddingBottom0 kesenheimer-container">
                    <div class="inner container-fluid">
                        <div class="neos-contentcollection">
                            <!-- Text -->
                            <div class="neos-nodetypes-html">
                                <div class="paddingTop30 paddingBottom15 kesenheimer-text">
                                    <div class="paddingTop0 paddingBottom15 kesenheimer-headline">
                                        <div>
                                            <h1>Glitching firmware versions v1.6.1 and later</h1>
                                        </div>
                                    </div>
                                    <div>
                                        <p></p>
                                    </div>
                                </div>
                            </div>
                            <div class="row paddingTop0 paddingBottom30 neos-nodetypes-twocolumn">
                                <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12 is-page neos-contentcollection"></div>
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 is-page neos-contentcollection"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="footer">
            <div class="copy">
                <div class="inner">
                    <div class="neos-contentcollection">
                        <div class="paddingTop15 paddingBottom15 kesenheimer-text">
                            <div>
                                <p style="text-align:center">
                                    <a href="/impressum.html">Impressum</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
